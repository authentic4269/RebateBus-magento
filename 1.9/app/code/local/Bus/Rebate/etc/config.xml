<?xml version="1.0"?>
<config>
    <modules>
        <Bus_Rebate>
            <version>0.1.0</version>
        </Bus_Rebate>
    </modules>
    <frontend>
        <layout>
            <updates>
                <module>
                    <file>rebatebus/rebatebus_layout.xml</file>
                </module>
            </updates>
        </layout>
	<routers>
		<checkout>
			<args>
				<modules>
					<Bus_Rebate before="Mage_Checkout">Bus_Rebate</Bus_Rebate>
				</modules>
			</args>
		</checkout>
	</routers>
    </frontend>
    <global>
        <blocks>
		<sales>
			<rewrite>
				<order_totals>Bus_Rebate_Block_Sales_Order_Totals</order_totals>	
				<order_invoice_totals>Bus_Rebate_Block_Sales_Order_Invoice_Totals</order_invoice_totals>
				<order_creditmemo_totals>Bus_Rebate_Block_Sales_Order_Creditmemo_Totals</order_creditmemo_totals>
			</rewrite>
		</sales>
		<adminhtml>
			<rewrite>
			    <sales_order_totals>Bus_Rebate_Adminhtml_Block_Sales_Order_Totals</sales_order_totals>
			    <sales_order_invoice_totals>Bus_Rebate_Adminhtml_Block_Sales_Order_Invoice_Totals</sales_order_invoice_totals>
			    <sales_order_creditmemo_totals>Bus_Rebate_Adminhtml_Block_Sales_Order_Creditmemo_Totals</sales_order_creditmemo_totals>

			</rewrite>
		</adminhtml>
	
            <rebatebus>
                <class>Bus_Rebate_Block</class>
            </rebatebus>
	</blocks>
	<models>
		<sales>
			<rewrite>
				<order_invoice>Bus_Rebate_Model_Order_Invoice</order_invoice>
			</rewrite>
	
		</sales>
		<rebate>
				<class>Bus_Rebate_Model</class>
				<resourceModel>rebate_resource</resourceModel>
				<rewrite>
					<order_invoice>Bus_Rebate_Model_Order_Invoice</order_invoice>
				</rewrite>
		</rebate>
		<rebate_resource>
			<class>Bus_Rebate_Model_Resource</class>	
			<entities>
				<rebate>
					<table>sales_flat_quote_item_rebate</table>
				</rebate>
			</entities>
		</rebate_resource>
	</models>
	<sales>
		 <quote>
		     <totals>
			 <rebates>
			     <class>rebate/quote_total_rebates</class>
			     <after>subtotal</after>
			     <before>tax</before>
			 </rebates>
		     </totals>
		 </quote>

		 <order_invoice>
		     <totals>
			 <rebates>
			     <class>rebate/order_invoice_rebates</class>
			     <after>subtotal</after>
			     <before>tax</before>
			 </rebates>
		     </totals>

		 </order_invoice>


		 <order_creditmemo>
		     <totals>
			 <rebates>
			     <class>rebate/order_creditmemo_rebates</class>
			     <after>subtotal</after>
			     <before>tax</before>
			 </rebates>
		     </totals>

		 </order_creditmemo>

	</sales>
        <pdf>
            <totals>
                <rebates>
                   <title>Rebate Total</title>
                   <source_field>rowtotal</source_field>
                   <model>rebate/order_pdf_total_rebates</model>
                   <amount_prefix>-</amount_prefix>
                   <font_size>7</font_size>
                   <display_zero>1</display_zero>
                </rebates>
            </totals>
        </pdf>
	<events>
<!--		<sales_order_invoice_save_after>
			<observers>
				<bus_rebate_model_observer>
					<type>singleton</type>
					<class>Bus_Rebate_Model_Observer</class>
					<method>sendInvoiceEmail</method>
				</bus_rebate_model_observer>
			</observers>
		</sales_order_invoice_save_after>
-->
	</events>
 
    </global>
</config>
